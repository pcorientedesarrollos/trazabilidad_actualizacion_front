<div class="p-6 flex flex-col w-full">
  <h1 class="text-2xl font-bold mb-4">Apicultores</h1>
  <div class="flex justify-between items-center mb-4 flex-wrap gap-4 bg-white p-3 rounded shadow">


    <div class="w-full max-w-md flex items-center gap-4">
      <app-search-bar [label]="'Buscar apicultor'" [placeholder]="'Escribe aquí...'" [value]="searchTerm"
        (valueChange)="onSearchChange($event)">
      </app-search-bar>

      <select
        class="border border-gray-300 rounded px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 mt-6 ml-8"
        [(ngModel)]="estadoFiltro" (ngModelChange)="paginaActual = 1">
        <option value="todos">Todos</option>
        <option value="activo">Activos</option>
        <option value="inactivo">Inactivos</option>
      </select>
    </div>


    <div class="flex gap-8 mt-4 mr-6 ">
      <app-button label="Descargar" [title]="'Descargar datos'" [bgColor]="'bg-green-600'"   icon="sim_card_download" [labelColor]="'text-white'"
        [hoverColor]="'hover:bg-green-700'" [size]="'md'" (clicked)="ExelDownload()">

      </app-button>

      <app-button label="Agregar" [title]="'Agregar Apicultores'" [bgColor]="'bg-yellow-500'"  icon="add_2" [labelColor]="'text-white'"
        [hoverColor]="'hover:bg-yellow-700'" [size]="'md'" (click)="openModal()">
      </app-button>
    </div>
  </div>

  <!-- Tabla de Apicultores -->
  <div class="relative overflow-x-auto shadow-md sm:rounded-lg ">
<!-- Spinner animado mientras carga -->
<div *ngIf="isLoading" class="flex flex-col items-center justify-center py-20 text-gray-600">
  <!-- Spinner circular -->
  <div class="w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin"></div>

  <!-- Texto de carga -->
  <p class="mt-4 text-lg font-semibold">Cargando apicultores...</p>
</div>

   <app-table
  *ngIf="!isLoading && paginados.length > 0"
  [columnas]="columnas"
  [data]="paginados"
  [templateAcciones]="accionesTemplate">
</app-table>
<div *ngIf="!isLoading && paginados.length === 0" class="flex flex-col items-center justify-center py-12 text-gray-500">
  <!-- Icono SVG abeja estilizado -->
  <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-20 text-yellow-400 mb-6 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 2v4m4-2a2 2 0 012 2v3a2 2 0 01-2 2m-8-7a2 2 0 00-2 2v3a2 2 0 002 2m4 3v7m0 0a2 2 0 01-2 2H8a2 2 0 01-2-2v-3a2 2 0 012-2m6-2h.01" />
  </svg>
  
  <p class="text-xl font-semibold">No hay apicultores para mostrar</p>
</div>
    <ng-template #accionesTemplate let-apicultor>
      <button  *ngIf="estadoFiltro === 'activo' || (estadoFiltro === 'todos' && apicultor.estatus?.toLowerCase() === 'activo')"
      class="text-blue-600 hover:underline" (click)="updateModal(apicultor)">
        <span class="material-symbols-outlined">edit_square</span>
      </button>

<button
  *ngIf="estadoFiltro === 'activo' || (estadoFiltro === 'todos' && apicultor.estatus?.toLowerCase() === 'activo')"
  class="text-green-500 hover:underline"
  [title]="'Activar apicultor'"
  (click)="cambiarEstado(apicultor, false)">
  <span class="material-symbols-outlined">power_settings_new</span>
</button>

    <button
  *ngIf="estadoFiltro === 'inactivo' || (estadoFiltro === 'todos' && apicultor.estatus?.toLowerCase() === 'inactivo')"
  class="text-red-600 hover:underline"
  [title]="'Baja apicultor'"
  (click)="cambiarEstado(apicultor, true)">
  <span class="material-symbols-outlined">delete</span>
</button>
    </ng-template>


  </div>

  <!-- Paginación -->
  <app-paginacion [paginaActual]="paginaActual" [totalPaginas]="totalPaginas" (cambiarPagina)="cambiarPagina($event)">
  </app-paginacion>

  <app-footer></app-footer>

  <!-- Modal Add Apicultor -->
  <app-modal
  [isOpen]="isModalAddOpen"
  (closeModal)="closeModal()"
  [title]="'Agregar Apicultor'"
>
  <form [formGroup]="agregarApicultorForm" (ngSubmit)="agregarApicultor()" class="space-y-4">

    <!-- Contenedor grid para los campos -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Campos existentes -->

      <div>
        <label for="nombre" class="block text-gray-800 mb-1 font-medium">Nombre:</label>
        <input
          type="text"
          id="nombre"
          placeholder="Nombre"
          formControlName="nombre"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
          required
        />
      </div>

      <div>
        <label for="curp" class="block text-gray-800 mb-1 font-medium">CURP:</label>
        <input
          type="text"
          id="curp"
          placeholder="CURP"
          formControlName="CURP"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
          required
        />
      </div>

      <div>
        <label for="rfc" class="block text-gray-800 mb-1 font-medium">RFC:</label>
        <input
          type="text"
          id="rfc"
          placeholder="RFC"
           formControlName="RFC"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

    <div>
  <label for="alta" class="block text-gray-800 mb-1 font-medium">Alta:</label>
  <input
    type="datetime-local"
    id="alta"
    formControlName="alta"
    class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
  />
</div>

      <div>
        <label for="direccion" class="block text-gray-800 mb-1 font-medium">Dirección:</label>
        <input
          type="text"
          id="direccion"
          placeholder="Dirección"
           formControlName="direccion"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="estadoCodigo" class="block text-gray-800 mb-1 font-medium">Estado Código:</label>
        <input
          type="text"
          id="estadoCodigo"
          placeholder="Estado Código"
          formControlName="estado_codigo"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="municipio" class="block text-gray-800 mb-1 font-medium">Municipio:</label>
        <input
          type="text"
          id="municipio"
          placeholder="Ej: 001"
          formControlName="municipio_codigo"
          maxlength="3"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="senasica" class="block text-gray-800 mb-1 font-medium">SENASICA:</label>
        <input
          type="number"
          id="senasica"
          placeholder="SENASICA"
          formControlName="Senasica"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="ippSiniga" class="block text-gray-800 mb-1 font-medium">IPP SINIGA:</label>
        <input
          type="text"
          id="ippSiniga"
          placeholder="IPP SINIGA"
          formControlName="IPPSiniga"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="codigo" class="block text-gray-800 mb-1 font-medium">Código:</label>
        <input
          type="text"
          id="codigo"
          placeholder="Código"
          formControlName="codigo"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <!-- Dropdown de Acopiador -->
      <div>
        <label for="acopiador" class="block text-gray-800 mb-1 font-medium">Asignar Acopiador:</label>
        <select
  id="acopiador"
  formControlName="idProveedor"
  class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
  required
>
  <option value="" disabled selected>Selecciona un acopiador</option>
  <option *ngFor="let acopiador of acopiadores" [value]="acopiador.idProveedor">
    {{ acopiador.nombreAcopiador }}
  </option>
</select>
      </div>
    </div>

    <!-- Botón -->
    <div class="flex justify-end">
      <app-button
        label="Guardar"
        [type]="'submit'"
        [title]="'Guardar Apicultor'"
        [bgColor]="'bg-yellow-500'"
        [hoverColor]="'hover:bg-yellow-700'"
        [size]="'sm'"
      >
      </app-button>
    </div>
  </form>
</app-modal>

  <!-- Modal Update Apicultor -->
  <app-modal
  [isOpen]="isModalUpdateOpen"
  (closeModal)="closeModalUpdate()"
  [title]="'Actualizar Apicultor'"
>
  <form [formGroup]="actualizarApicultorForm" (ngSubmit)="editarApicultor()" class="space-y-4">

    <!-- Contenedor grid para los campos -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Campos existentes -->

      <div>
        <label for="nombre" class="block text-gray-800 mb-1 font-medium">Nombre:</label>
        <input
          type="text"
          id="nombre"
          placeholder="Nombre"
          formControlName="nombre"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
          required
        />
      </div>

      <div>
        <label for="curp" class="block text-gray-800 mb-1 font-medium">CURP:</label>
        <input
          type="text"
          id="curp"
          placeholder="CURP"
          formControlName="CURP"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
          required
        />
      </div>

      <div>
        <label for="rfc" class="block text-gray-800 mb-1 font-medium">RFC:</label>
        <input
          type="text"
          id="rfc"
          placeholder="RFC"
           formControlName="RFC"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

    <div>
  <label for="alta" class="block text-gray-800 mb-1 font-medium">Alta:</label>
  <input
    type="datetime-local"
    id="alta"
    formControlName="alta"
    class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
  />
</div>

      <div>
        <label for="direccion" class="block text-gray-800 mb-1 font-medium">Dirección:</label>
        <input
          type="text"
          id="direccion"
          placeholder="Dirección"
           formControlName="direccion"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="estadoCodigo" class="block text-gray-800 mb-1 font-medium">Estado Código:</label>
        <input
          type="text"
          id="estadoCodigo"
          placeholder="Estado Código"
          formControlName="estado_codigo"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="municipio" class="block text-gray-800 mb-1 font-medium">Municipio:</label>
        <input
          type="text"
          id="municipio"
          placeholder="Ej: 001"
          formControlName="municipio_codigo"
          maxlength="3"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="senasica" class="block text-gray-800 mb-1 font-medium">SENASICA:</label>
        <input
          type="number"
          id="senasica"
          placeholder="SENASICA"
          formControlName="Senasica"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="ippSiniga" class="block text-gray-800 mb-1 font-medium">IPP SINIGA:</label>
        <input
          type="text"
          id="ippSiniga"
          placeholder="IPP SINIGA"
          formControlName="IPPSiniga"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>

      <div>
        <label for="codigo" class="block text-gray-800 mb-1 font-medium">Código:</label>
        <input
          type="text"
          id="codigo"
          placeholder="Código"
          formControlName="codigo"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700"
        />
      </div>
    </div>

    <!-- Botón -->
    <div class="flex justify-end">
      <app-button
        label="Guardar"
        [type]="'submit'"
        [title]="'Guardar'"
        [bgColor]="'bg-yellow-500'"
        [hoverColor]="'hover:bg-yellow-700'"
        [size]="'sm'"
      >
      </app-button>
    </div>
  </form>
</app-modal>

<app-alert
  [show]="isAlertOpen"
  [icon]="accionModal === 'alta' ? 'check_circle' : accionModal === 'baja' ? 'highlight_off' : 'info'"
  [iconColor]="accionModal === 'alta' ? 'text-green-500' : accionModal === 'baja' ? 'text-red-500' : 'text-blue-500'"
  [title]="
    accionModal === 'alta'
      ? 'Alta Apicultor'
      : accionModal === 'baja'
      ? 'Baja Apicultor'
      : 'Actualizar Apicultor'
  "
  [message]="alertMessage"
  [confirmText]="'Sí, confirmar'"
  [cancelText]="'Cancelar'"
  (confirm)="confirmarCambioEstado()"
  (cancel)="cancelarCambioEstado()">
</app-alert>


</div>