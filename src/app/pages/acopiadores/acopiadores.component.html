<div class="p-6 flex flex-col w-full">
  <h1 class="text-2xl font-bold mb-4">Acopiadores</h1>
  <div class="flex justify-between items-center mb-4 flex-wrap gap-4 bg-white p-3 rounded shadow">

    <div class="w-full max-w-md flex items-center gap-4">
      <app-search-bar [label]="'Buscar apicultor'" [placeholder]="'Escribe aquí...'" [value]="searchTerm"
        (valueChange)="onSearchChange($event)">
      </app-search-bar>

      <select
        class="border border-gray-300 rounded px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 mt-6 ml-8"
        [(ngModel)]="estadoFiltro" (ngModelChange)="paginaActual = 1">
        <option value="todos">Todos</option>
        <option value="activo">Activos</option>
        <option value="inactivo">Inactivos</option>
      </select>
    </div>
    <div class="flex gap-8 mt-4 mr-6 ">
      <app-button label="Descargar" [title]="'Descargar datos'" [bgColor]="'bg-green-600'" icon="sim_card_download"
        [labelColor]="'text-white'" [hoverColor]="'hover:bg-green-700'" [size]="'md'" (clicked)="ExelDownload()">
      </app-button>
      <app-button label="Agregar" [title]="'Agregar Apicultores'" [bgColor]="'bg-yellow-500'" icon="add_2"
        [labelColor]="'text-white'" [hoverColor]="'hover:bg-yellow-700'" [size]="'md'" (click)="openModal()">
      </app-button>
    </div>
  </div>
  <div class="relative overflow-x-auto shadow-md sm:rounded-lg ">
    <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-20 text-gray-600">
  <div class="w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin"></div>
  <p class="mt-4 text-lg font-semibold">Cargando acopiadores...</p>
</div>
    <app-table   *ngIf="!isLoading && paginados.length > 0" [columnas]="columnas" [data]="paginados" [templateAcciones]="accionesTemplate"></app-table>
    <div *ngIf="!isLoading && paginados.length === 0" class="flex flex-col items-center justify-center py-12 text-gray-500">
  <!-- Icono SVG abeja estilizado -->
  <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-20 text-yellow-400 mb-6 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 2v4m4-2a2 2 0 012 2v3a2 2 0 01-2 2m-8-7a2 2 0 00-2 2v3a2 2 0 002 2m4 3v7m0 0a2 2 0 01-2 2H8a2 2 0 01-2-2v-3a2 2 0 012-2m6-2h.01" />
  </svg>
  
  <p class="text-xl font-semibold">No hay acopiadores para mostrar</p>
</div>
<ng-template #accionesTemplate let-acopiadorConApicultor>


  <button  *ngIf="estadoFiltro === 'activo' || (estadoFiltro === 'todos' && acopiadorConApicultor.estatus?.toLowerCase() === 'activo')"
    class="text-green-500 hover:underline"
    (click)="cambiarEstado(acopiadorConApicultor, true)"
    [title]="'Dar de alta acopiador'">
    <span class="material-symbols-outlined">power_settings_new</span>
  </button>



  <button  *ngIf="estadoFiltro === 'activo' || (estadoFiltro === 'todos' && acopiadorConApicultor.estatus?.toLowerCase() === 'activo')"
    class="text-blue-600 hover:underline"
    (click)="updateModal(acopiadorConApicultor)"
    [title]="'Editar acopiador'">
    <span class="material-symbols-outlined">edit_square</span>
  </button>

  <button   *ngIf="estadoFiltro === 'inactivo' || (estadoFiltro === 'todos' && acopiadorConApicultor?.toLowerCase() === 'inactivo')"
    class="text-red-600 hover:underline"
    (click)="cambiarEstado(acopiadorConApicultor, false)"
    [title]="'Dar de baja acopiador'">
    <span class="material-symbols-outlined">delete</span>
  </button>



</ng-template>
  </div>
  <app-paginacion [paginaActual]="paginaActual" [totalPaginas]="totalPaginas" (cambiarPagina)="cambiarPagina($event)">
  </app-paginacion>
  <app-footer></app-footer>

  <app-modal [isOpen]="isModalAddOpen" (closeModal)="closeModal()" [title]="'Agregar Acopiador'">
    <form [formGroup]="agregarAcopiadorForm" (ngSubmit)="agregarAcopiador()">

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <!-- Nombre del Acopiador -->
        <div>
          <label for="nombre" class="block text-gray-800 mb-1 font-medium">Nombre del Acopiador:</label>
          <input type="text" id="nombre" placeholder="Nombre del acopiador" formControlName="nombre"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" required />
        </div>

        <!-- idDatosFiscales -->
        <div>
          <label for="idDatosFiscales" class="block text-gray-800 mb-1 font-medium">ID Datos Fiscales:</label>
          <input type="number" id="idDatosFiscales" placeholder="DatosFiscales" formControlName="idDatosFiscales"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" />
        </div>

        <!-- idDireccion -->
        <div>
          <label for="idDireccion" class="block text-gray-800 mb-1 font-medium">ID Dirección:</label>
          <input type="number" id="idDireccion" placeholder="Dirección" formControlName="idDireccion"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" />
        </div>

        <!-- idSagarpa -->
        <div>
          <label for="idSagarpa" class="block text-gray-800 mb-1 font-medium">ID Sagarpa:</label>
          <input type="text" id="idSagarpa" placeholder="Sagarpa" formControlName="idSagarpa"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" />
        </div>

        <!-- tipoDeMiel -->
        <div>
          <label for="tipoDeMiel" class="block text-gray-800 mb-1 font-medium">Tipo de Miel:</label>
          <input type="number" id="tipoDeMiel" placeholder="TipoMiel" formControlName="tipoDeMiel"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" />
        </div>

        <!-- cantidad -->
        <div>
          <label for="cantidad" class="block text-gray-800 mb-1 font-medium">Cantidad:</label>
          <input type="number" id="cantidad" placeholder="Cantidad" formControlName="cantidad"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" />
        </div>

     
        <!-- idEstado (Dropdown) -->
      <div>
        <label for="idEstado" class="block text-gray-800 mb-1 font-medium">Estado:</label>
        <select id="idEstado" formControlName="idEstado"  placeholder="Estado"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700">
          
          <option value="" disabled>-- Selecciona un estado --</option>
          <option *ngFor="let estado of estados" [value]="estado.idEstado">
            {{ estado.nombre }}
          </option>
        </select>
      </div>


        <!-- Latitud -->
        <div>
          <label for="latitud" class="block text-gray-800 mb-1 font-medium">Latitud:</label>
          <input type="number" id="latitud" placeholder="Latitud" formControlName="latitud"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" step="0.000001" />
        </div>

        <!-- Longitud -->
        <div>
          <label for="longitud" class="block text-gray-800 mb-1 font-medium">Longitud:</label>
          <input type="number" id="longitud" placeholder="Longitud" formControlName="longitud"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" step="0.000001" />
        </div>

        <!-- Dropdown de Acopiador -->
        <div>
          <label for="id_apicultor" class="block text-gray-800 mb-1 font-medium">Asignar Apicultor:</label>
          <select id="id_apicultor"  formControlName="idApicultor"
            class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700">

            <option value="" disabled>-- Asignar apicultor --</option>

            <option *ngFor="let apicultor of apicultores" [value]="apicultor.idApicultor">
              {{ apicultor.nombre }}
            </option>
          </select>
        </div>
      </div>


      <!-- Botón de guardar -->
      <div class="flex justify-end mt-4">
        <app-button label="Guardar" [type]="'submit'" [title]="'Guardar acopiador'" [bgColor]="'bg-yellow-500'"
          [hoverColor]="'hover:bg-yellow-700'" [size]="'sm'">
        </app-button>
      </div>
    </form>
  </app-modal>

<app-modal [isOpen]="isModalUpdateOpen" (closeModal)="closeModalUpdate()" [title]="'Actualizar Acopiador'">
  <form [formGroup]="actualizarAcopiadorForm" (ngSubmit)="editarAcopiador()" class="space-y-4">

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      
      <!-- Nombre del Acopiador -->
      <div>
        <label for="nombre" class="block text-gray-800 mb-1 font-medium">Nombre del Acopiador:</label>
        <input type="text" id="nombre" formControlName="nombre"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" />
      </div>

      <!-- ID Sagarpa -->
      <div>
        <label for="idSagarpa" class="block text-gray-800 mb-1 font-medium">ID Sagarpa:</label>
        <input type="text" id="idSagarpa" formControlName="idSagarpa"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" />
      </div>

      <!-- Latitud -->
      <div>
        <label for="latitud" class="block text-gray-800 mb-1 font-medium">Latitud:</label>
        <input type="number" id="latitud" formControlName="latitud"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" step="0.000001" />
      </div>

      <!-- Longitud -->
      <div>
        <label for="longitud" class="block text-gray-800 mb-1 font-medium">Longitud:</label>
        <input type="number" id="longitud" formControlName="longitud"
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700" step="0.000001" />
      </div>

      <!-- Estado -->
<div>
        <label for="idEstado" class="block text-gray-800 mb-1 font-medium">Estado:</label>
        <select id="idEstado" formControlName="idEstado"  
          class="w-full text-sm py-1.5 px-2 border border-gray-400 rounded text-gray-700">
          
          <option value="" disabled >-- Selecciona un estado --</option>
          <option *ngFor="let estado of estados" [value]="estado.idEstado">
  {{ estado.nombre }}
</option>
        </select>
      </div>

    </div>

    <!-- Botón de Guardar -->
    <div class="flex justify-end mt-4">
      <app-button label="Guardar" [type]="'submit'" [title]="'Guardar cambios'" [bgColor]="'bg-yellow-500'"
        [hoverColor]="'hover:bg-yellow-700'" [size]="'sm'">
      </app-button>
    </div>
  </form>
</app-modal>

<app-alert
  [show]="isAlertOpen"
  [icon]="accionModal === 'alta' ? 'check_circle' : accionModal === 'baja' ? 'highlight_off' : 'info'"
  [iconColor]="accionModal === 'alta' ? 'text-green-500' : accionModal === 'baja' ? 'text-red-500' : 'text-blue-500'"
  [title]="
    accionModal === 'alta'
      ? 'Alta Acopiador'
      : accionModal === 'baja'
      ? 'Baja Acopiador'
      : 'Actualizar Acopiador'
  "
  [message]="alertMessage"
  [confirmText]="'Sí, confirmar'"
  [cancelText]="'Cancelar'"
  (confirm)="confirmarCambioEstado()"
  (cancel)="cancelarCambioEstado()">
</app-alert>


</div>